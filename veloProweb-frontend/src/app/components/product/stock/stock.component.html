<div class="container-fluid d-flex flex-column p-1">
  <div class="p-0 pb-0">
    <div
      class="d-flex flex-lg-row flex-column justify-content-between m-2 mb-3"
    >
      <button
        type="button"
        class="btn btn-outline-light btn-lg ms-2"
        data-bs-toggle="modal"
        data-bs-target="#addProduct"
        (click)="modalService.openModal()"
      >
        <p class="fw-bold fs-4 m-0">Producto</p>
      </button>
      <button
        type="button"
        class="btn btn-outline-light btn-lg"
        data-bs-toggle="modal"
        data-bs-target="#categoriesModal"
      >
        <p class="fw-bold fs-4 m-0">Categorías</p>
      </button>
      <a
        type="button"
        class="btn btn-outline-light btn-lg"
        [routerLink]="['/proveedores']"
      >
        <p class="fw-bold fs-4 m-0">Proveedor</p>
      </a>
      <a 
        type="button" 
        class="btn btn-outline-light btn-lg me-2"
        [routerLink]="['/compras']"
        target="_blank">
        <p class="fw-bold fs-4 m-0">Compras</p>
      </a>
    </div>
    <div class="d-flex flex-lg-row flex-column m-1 align-items-center justify-content-between position-relative">
      <div class="order-lg-0 order-2 d-flex flex-column align-items-start">
        <div class="form-floating mb-1">
          <input
            id="searchProduct"
            [(ngModel)]="textFilter"
            (ngModelChange)="searchFilterCustomer()"
            type="text"
            class="form-control form-control-lg"
            aria-label="buscar producto filtrado"
            aria-describedby="inputGroup-sizing-md"
            placeholder="Ingrese un valor"
          />
          <label for="searchProduct" class="form-label">Búsqueda Rápida</label>
        </div>
      </div>
      <div class="border border-1 border-white p-1 mb-2 mt-0 my-4 d-flex flex-row position-absolute start-50 translate-middle-x">
        <div class="m-1">
          <span class="mt-1 d-inline-block ms-4" style="width: 15px;height: 15px;background-color: rgb(40, 238, 40);"></span>
          <p class="ms-1 mb-0 fw-semibold">Disponible</p>
        </div>
        <div class="m-1">
          <span class="mt-1 d-inline-block ms-5" style="width: 15px;height: 15px;background-color: rgb(9, 180, 237);"></span>
          <p class="ms-1 mb-0 fw-semibold">No Disponible</p>
        </div>
        <div class="m-1">
          <span class="mt-1 d-inline-block ms-5" style="width: 15px;height: 15px;background-color: red"></span>
          <p class="ms-1 mb-0 fw-semibold">Descontinuado</p>
        </div>
      </div>
    </div>
  </div>
  <div class="text-center p-2 pt-0 table-responsive" style="max-height: 350px">
    <table class="table table-hover">
      <thead class="table-light">
        <tr>
          <th scope="col" class="position-sticky top-0">#</th>
          <th scope="col" class="position-sticky top-0">Marca</th>
          <th scope="col" class="position-sticky top-0">Categoría</th>
          <th scope="col" class="position-sticky top-0">Subcategoría</th>
          <th scope="col" class="position-sticky top-0">Descripción</th>
          <th scope="col" class="position-sticky top-0">Un</th>
          <th scope="col" class="position-sticky top-0">Compra</th>
          <th scope="col" class="position-sticky top-0">Venta</th>
          <th scope="col" class="position-sticky top-0">Stock</th>
          <th scope="col" class="position-sticky top-0">Estado</th>
          <th scope="col" class="position-sticky top-0">Acción</th>
        </tr>
      </thead>
      <tbody class="table-group-divider text-center align-middle">
        <tr *ngFor="let product of filteredProducts">
          <th scope="row">{{ product.id }}</th>
          <td>{{ product.brand.name }}</td>
          <td>{{ product.category.name }}</td>
          <td>{{ product.subcategoryProduct.name }}</td>
          <td>{{ product.description }}</td>
          <td>{{ product.unit.nameUnit }}</td>
          <td>{{ product.buyPrice | currency : "CLP" : "$" : "1.0-0" }}</td>
          <td>{{ product.salePrice | currency : "CLP" : "$" : "1.0-0" }}</td>
          <td>{{ product.stock }}</td>
          <td
            [ngStyle]="{
              'background-color': statusColor(product.statusProduct)
            }"
          ></td>
          <td>
            <div>
              <button
                *ngIf="
                  product.statusProduct === statusProduct.AVAILABLE ||
                  product.statusProduct === statusProduct.UNAVAILABLE && 
                  product.buyPrice !== 0
                "
                class="btn btn-sm btn-warning m-1"
                data-bs-toggle="modal"
                data-bs-target="#updateProduct"
              >
                <img
                  src="/assets/icons/btnEditIcon.png"
                  alt="editar"
                  width="30"
                  height="30"
                  class="img-fluid"
                  (click)="openModalProduct(product)"
                />
              </button>
              <button
                *ngIf="product.statusProduct === statusProduct.UNAVAILABLE"
                (click)="deleteProduct(product)"
                class="btn btn-sm btn-danger m-1"
              >
                <img
                  src="/assets/icons/btnDeleteIcon.png"
                  alt="borrar"
                  width="30"
                  height="30"
                  class="img-fluid"
                />
              </button>
              <button
                *ngIf="product.statusProduct === statusProduct.DISCONTINUED"
                (click)="activateProduct(product)"
                class="btn btn-sm m-1"
              >
                <img
                  src="/assets/icons/iconOn.png"
                  alt="activar"
                  width="30"
                  height="30"
                  class="img-fluid"
                />
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<!-- Modal Add Product -->
<app-add-product (productAdded)="getProducts()"></app-add-product>
<!-- Modal Update Product -->
<app-update-product [selectedProduct]="selectedProduct" (productUpdated)="getProducts()"></app-update-product>
<!-- Modal Add Categories and Extras -->
<app-add-categories></app-add-categories>
